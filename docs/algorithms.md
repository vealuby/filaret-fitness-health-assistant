# Алгоритмы и логика

## Сон

- **Bedtime**: `bedtime = desired_wake_time − sleep_goal`, корректировка через модуль 24 часов.
- **Sleep debt**: суммируем недобор (goal - фактическая длительность) за последние 7 дней.
- **Chronotherapy**: если текущее среднее время отхода отличается >90 мин, планируем сдвиг на 15–30 мин в день до достижения цели.

## Питание

- Завтрак в течение 45 мин после пробуждения (пример и БЖУ в ответе).
- Обед — середина рабочего окна или +5 ч от подъёма, сбалансирован по белку/жиру/углеводам.
- Ужин адаптируется под тренировки: основной приём за 2–3 ч до тренировки, перекус за 30–60 мин до неё, восстановление через 30–60 мин после.
- Персонализация калоража: TDEE ≈ `10*вес + 6.25*рост - 5*32 - 161`, множитель активности 1.4, далее корректировка по целям (дефицит -300 ккал для weight_loss, +200 ккал для muscle_gain).

## Вода

- Распределяем цель по дневному окну (12–14 ч).
- Порции ≥150 мл, повторные напоминания максимум 2 раза (15-мин интервал).

## Тренировки

- Планируем по недельному расписанию (день недели + время).
- Отменённая тренировка → пересчёт плана питания (удаление перекусов, корректировка ужина).
- Завершённая тренировка → опрос самочувствия 0–4 и сохранение wellness-score.
- Ручной лог «Я был на тренировке» собирает время, тип, длительность, интенсивность, wellness.

## Лекарства

- Каждый препарат хранит название/дозировку/время приёма.
- Если модуль активен, scheduler создаёт ежедневные напоминания `ReminderType.MEDICATION`.
- Управление через `/meds` (добавление/удаление, inline-кнопки).

## Симптомы

- Команда `/symptoms` собирает описание + уровень выраженности (0–3).
- Запись сохраняется в `SymptomLog` и при наличии LLM выдаёт образовательный ответ с дисклеймером.

## LLM

- Используется OpenAI `gpt-4o-mini`.
- Системный промпт запрещает диагнозы, добавляется обязательный дисклеймер.

## Источники

1. [AASM Bedtime Calculator](https://sleepeducation.org/healthy-sleep/bedtime-calculator/)
2. [Consensus Statement (AASM, 2016)](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5078711/)
3. [Guzzetti et al., 2022](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC10108639/)
4. [Boege et al., 2020](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7997809/)
5. [Barion & Zee, 2007](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2679862/)

